<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presence × Pursuit (PxP) - Privacy-First Presence Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .pxp-btn {
            transition: all 0.2s ease-in-out;
        }
        
        .pxp-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .pxp-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .pxp-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        
        .status-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .heartbeat {
            animation: heartbeat 1s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-broadcast-tower text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Presence × Pursuit</h1>
                        <p class="text-sm text-gray-500">Privacy-First Presence Detection</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">PxP v1.0</span>
                    <div id="systemStatus" class="w-3 h-3 bg-green-500 rounded-full status-indicator"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Ethics Statement -->
        <div class="pxp-card p-6 mb-8 border-l-4 border-blue-500">
            <div class="flex items-start space-x-3">
                <i class="fas fa-shield-alt text-blue-500 text-xl mt-1"></i>
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 mb-2">PxP Ethics Statement</h2>
                    <p class="text-gray-700 leading-relaxed">
                        <strong>PxP respects your autonomy.</strong> No cameras. No microphones. No facial recognition. 
                        Only ambient signal sensing — with your explicit permission. We believe in presence intelligence 
                        that knows you're here <em>without ever watching you</em>.
                    </p>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-lg shadow-sm mb-6">
            <nav class="flex space-x-8 px-6" role="tablist">
                <button id="onboardingTab" class="py-4 px-1 border-b-2 border-blue-500 text-blue-600 font-medium text-sm focus:outline-none" role="tab">
                    <i class="fas fa-user-plus mr-2"></i>Onboarding
                </button>
                <button id="detectionTab" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm focus:outline-none" role="tab">
                    <i class="fas fa-radar mr-2"></i>Detection
                </button>
                <button id="logsTab" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm focus:outline-none" role="tab">
                    <i class="fas fa-list-alt mr-2"></i>Logs
                </button>
            </nav>
        </div>

        <!-- Onboarding Panel -->
        <div id="onboardingPanel" class="tab-panel">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Registration Form -->
                <div class="pxp-card p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">
                        <i class="fas fa-clipboard-check text-blue-500 mr-2"></i>
                        PxP User Registration
                    </h2>
                    
                    <form id="registrationForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="fullName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your full name" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Device MAC Address</label>
                            <input type="text" id="macAddress" class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg" readonly>
                            <p class="text-xs text-gray-500 mt-1">Auto-generated for demo purposes</p>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0 mt-1">
                                    <input type="checkbox" id="consentToggle" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label for="consentToggle" class="text-sm font-medium text-gray-900">
                                        I consent to ambient presence detection
                                    </label>
                                    <p class="text-xs text-gray-600 mt-1">
                                        You understand that PxP will detect your device presence using privacy-first signal analysis. 
                                        No visual or audio monitoring. You can withdraw consent at any time.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium pxp-btn hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-user-check mr-2"></i>Register with PxP
                        </button>
                    </form>
                </div>

                <!-- Registered Users -->
                <div class="pxp-card p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">
                        <i class="fas fa-users text-green-500 mr-2"></i>
                        Registered Users
                    </h2>
                    
                    <div id="registeredUsers" class="space-y-3">
                        <p class="text-gray-500 text-center py-8">No users registered yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detection Panel -->
        <div id="detectionPanel" class="tab-panel hidden">
            <div class="grid lg:grid-cols-3 gap-6 mb-8">
                <!-- System Status -->
                <div class="pxp-card p-6 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-wifi text-2xl text-green-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">System Status</h3>
                    <p id="systemStatusText" class="text-sm text-green-600 font-medium">Active Scanning</p>
                    <div class="mt-3 text-xs text-gray-500">
                        <div>Scan Interval: 10s</div>
                        <div>Exit Timeout: 60min</div>
                    </div>
                </div>

                <!-- Current Presence -->
                <div class="pxp-card p-6 text-center">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-users text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Current Presence</h3>
                    <p id="currentPresence" class="text-2xl font-bold text-blue-600">0</p>
                    <p class="text-sm text-gray-500">Users Detected</p>
                </div>

                <!-- Today's Activity -->
                <div class="pxp-card p-6 text-center">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4 heartbeat">
                        <i class="fas fa-heartbeat text-2xl text-purple-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">Today's Activity</h3>
                    <p id="todayActivity" class="text-2xl font-bold text-purple-600">0</p>
                    <p class="text-sm text-gray-500">Total Events</p>
                </div>
            </div>

            <!-- Real-time Detection Feed -->
            <div class="pxp-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">
                        <i class="fas fa-broadcast-tower text-blue-500 mr-2"></i>
                        Real-time Detection Feed
                    </h2>
                    <div class="flex items-center space-x-2 text-sm text-gray-500">
                        <div class="w-2 h-2 bg-green-400 rounded-full status-indicator"></div>
                        <span>Live</span>
                    </div>
                </div>
                
                <div id="detectionFeed" class="space-y-3 max-h-96 overflow-y-auto">
                    <p class="text-gray-500 text-center py-8">Waiting for presence detection...</p>
                </div>
            </div>
        </div>

        <!-- Logs Panel -->
        <div id="logsPanel" class="tab-panel hidden">
            <div class="pxp-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">
                        <i class="fas fa-table text-blue-500 mr-2"></i>
                        PxP Presence Logs
                    </h2>
                    <div class="flex space-x-3">
                        <button id="refreshLogs" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium pxp-btn hover:bg-blue-700">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                        <button id="exportLogs" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium pxp-btn hover:bg-green-700">
                            <i class="fas fa-download mr-2"></i>Export
                        </button>
                        <button id="clearLogs" class="bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium pxp-btn hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Clear
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Timestamp</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motion</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Heart Rate</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="6" class="px-4 py-8 text-center text-gray-500">No presence logs available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Future Architecture Notes -->
        <div class="mt-8 pxp-card p-6 bg-gradient-to-r from-purple-50 to-blue-50">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">
                <i class="fas fa-rocket text-purple-500 mr-2"></i>
                Future: WiSpy Integration
            </h2>
            <div class="grid md:grid-cols-2 gap-6 text-sm text-gray-700">
                <div>
                    <h3 class="font-medium mb-2">Hardware Architecture:</h3>
                    <ul class="space-y-1">
                        <li>• Raspberry Pi 5 edge computing</li>
                        <li>• Camera Module 3 NoIR Wide (calibration only)</li>
                        <li>• WiFi/Bluetooth MAC scanning</li>
                        <li>• mmWave Doppler sensing</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-medium mb-2">Industry Applications:</h3>
                    <ul class="space-y-1">
                        <li>• Fitness Studios (Orangetheory, Equinox)</li>
                        <li>• Education (Pursuit, K-12, Universities)</li>
                        <li>• Healthcare & Elder Care</li>
                        <li>• Defense & Secure Facilities</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <script>
        // PxP Application State Management
        class PxPApp {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('pxp_users')) || [];
                this.logs = JSON.parse(localStorage.getItem('pxp_logs')) || [];
                this.detectionInterval = null;
                this.currentPresence = new Set();
                this.lastSeen = new Map();
                
                this.initializeApp();
            }

            initializeApp() {
                this.setupEventListeners();
                this.generateMacAddress();
                this.switchTab('onboarding');
                this.updateUI();
                this.startDetection();
            }

            // Supabase Function Block Simulation - Insert User
            async insertUser(userData) {
                const user = {
                    id: Date.now(),
                    fullName: userData.fullName,
                    macAddress: userData.macAddress,
                    consentGiven: userData.consentGiven,
                    registeredAt: new Date().toISOString(),
                    status: 'registered'
                };
                
                this.users.push(user);
                localStorage.setItem('pxp_users', JSON.stringify(this.users));
                
                // Simulate network delay
                return new Promise(resolve => {
                    setTimeout(() => resolve(user), 300);
                });
            }

            // Supabase Function Block Simulation - Log Presence
            async logPresence(presenceData) {
                const log = {
                    id: Date.now() + Math.random(),
                    userId: presenceData.userId,
                    userName: presenceData.userName,
                    status: presenceData.status,
                    timestamp: new Date().toISOString(),
                    duration: presenceData.duration || null,
                    motionState: presenceData.motionState || null,
                    simulatedHeartRate: presenceData.simulatedHeartRate || null,
                    macAddress: presenceData.macAddress
                };
                
                this.logs.unshift(log);
                localStorage.setItem('pxp_logs', JSON.stringify(this.logs));
                
                return log;
            }

            // WiSpy Simulation - Passive Presence Detection
            simulatePresenceDetection() {
                this.users.forEach(user => {
                    // Simulate MAC address detection with 70% probability
                    const isDetected = Math.random() > 0.3;
                    const wasPresent = this.currentPresence.has(user.id);
                    
                    if (isDetected && !wasPresent) {
                        // User entered
                        this.currentPresence.add(user.id);
                        this.lastSeen.set(user.id, Date.now());
                        
                        this.logPresence({
                            userId: user.id,
                            userName: user.fullName,
                            macAddress: user.macAddress,
                            status: 'entered',
                            motionState: Math.random() > 0.5 ? 'moving' : 'still',
                            simulatedHeartRate: Math.floor(Math.random() * (90 - 55) + 55)
                        });
                        
                        this.addDetectionFeedItem({
                            type: 'entered',
                            user: user.fullName,
                            timestamp: new Date()
                        });
                        
                    } else if (isDetected && wasPresent) {
                        // User still present - update last seen
                        this.lastSeen.set(user.id, Date.now());
                        
                        // Occasionally log motion/heart rate updates
                        if (Math.random() > 0.8) {
                            this.logPresence({
                                userId: user.id,
                                userName: user.fullName,
                                macAddress: user.macAddress,
                                status: 'present',
                                motionState: Math.random() > 0.5 ? 'moving' : 'still',
                                simulatedHeartRate: Math.floor(Math.random() * (90 - 55) + 55)
                            });
                        }
                    }
                });
                
                // Check for users who have exited (not seen for 60+ seconds - accelerated for demo)
                const exitThreshold = 60 * 1000; // 60 seconds for demo (would be 60 minutes in production)
                const now = Date.now();
                
                this.currentPresence.forEach(userId => {
                    const lastSeenTime = this.lastSeen.get(userId);
                    if (now - lastSeenTime > exitThreshold) {
                        const user = this.users.find(u => u.id === userId);
                        if (user) {
                            this.currentPresence.delete(userId);
                            
                            const duration = Math.floor((now - lastSeenTime) / 1000 / 60); // minutes
                            
                            this.logPresence({
                                userId: user.id,
                                userName: user.fullName,
                                macAddress: user.macAddress,
                                status: 'exited',
                                duration: `${duration}m`
                            });
                            
                            this.addDetectionFeedItem({
                                type: 'exited',
                                user: user.fullName,
                                timestamp: new Date(),
                                duration: `${duration}m`
                            });
                        }
                    }
                });
                
                this.updateUI();
            }

            addDetectionFeedItem(item) {
                const feed = document.getElementById('detectionFeed');
                const feedItem = document.createElement('div');
                feedItem.className = 'flex items-center space-x-3 p-3 bg-gray-50 rounded-lg';
                
                const iconClass = item.type === 'entered' ? 'fa-sign-in-alt text-green-600' : 'fa-sign-out-alt text-red-600';
                const statusText = item.type === 'entered' ? 'Entered' : 'Exited';
                const durationText = item.duration ? ` (${item.duration})` : '';
                
                feedItem.innerHTML = `
                    <div class="flex-shrink-0">
                        <i class="fas ${iconClass}"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-900">${item.user} ${statusText}</div>
                        <div class="text-xs text-gray-500">${item.timestamp.toLocaleTimeString()}${durationText}</div>
                    </div>
                `;
                
                if (feed.children.length === 1 && feed.children[0].textContent.includes('Waiting for')) {
                    feed.innerHTML = '';
                }
                
                feed.insertBefore(feedItem, feed.firstChild);
                
                // Keep only last 20 items
                while (feed.children.length > 20) {
                    feed.removeChild(feed.lastChild);
                }
            }

            startDetection() {
                this.detectionInterval = setInterval(() => {
                    this.simulatePresenceDetection();
                }, 10000); // Every 10 seconds
            }

            stopDetection() {
                if (this.detectionInterval) {
                    clearInterval(this.detectionInterval);
                }
            }

            setupEventListeners() {
                // Tab navigation
                document.getElementById('onboardingTab').addEventListener('click', () => this.switchTab('onboarding'));
                document.getElementById('detectionTab').addEventListener('click', () => this.switchTab('detection'));
                document.getElementById('logsTab').addEventListener('click', () => this.switchTab('logs'));

                // Registration form
                document.getElementById('registrationForm').addEventListener('submit', (e) => this.handleRegistration(e));

                // Logs actions
                document.getElementById('refreshLogs').addEventListener('click', () => this.updateLogsTable());
                document.getElementById('exportLogs').addEventListener('click', () => this.exportLogs());
                document.getElementById('clearLogs').addEventListener('click', () => this.clearLogs());

                // Auto-refresh current presence display
                setInterval(() => this.updateUI(), 5000);
            }

            generateMacAddress() {
                const macAddress = `DemoMAC-${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}`;
                document.getElementById('macAddress').value = macAddress;
            }

            async handleRegistration(e) {
                e.preventDefault();
                
                const formData = {
                    fullName: document.getElementById('fullName').value,
                    macAddress: document.getElementById('macAddress').value,
                    consentGiven: document.getElementById('consentToggle').checked
                };

                if (!formData.consentGiven) {
                    alert('PxP requires explicit consent for presence detection.');
                    return;
                }

                try {
                    const user = await this.insertUser(formData);
                    
                    // Reset form and generate new MAC
                    document.getElementById('registrationForm').reset();
                    this.generateMacAddress();
                    
                    this.updateRegisteredUsers();
                    
                    alert(`Welcome to PxP, ${user.fullName}! You are now registered for privacy-first presence detection.`);
                } catch (error) {
                    alert('Registration failed. Please try again.');
                }
            }

            switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('[role="tab"]').forEach(tab => {
                    tab.classList.remove('border-blue-500', 'text-blue-600');
                    tab.classList.add('border-transparent', 'text-gray-500');
                });

                // Hide all panels
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.add('hidden');
                });

                // Show selected tab and panel
                document.getElementById(`${tabName}Tab`).classList.remove('border-transparent', 'text-gray-500');
                document.getElementById(`${tabName}Tab`).classList.add('border-blue-500', 'text-blue-600');
                document.getElementById(`${tabName}Panel`).classList.remove('hidden');

                // Update content based on tab
                if (tabName === 'logs') {
                    this.updateLogsTable();
                }
            }

            updateUI() {
                this.updateRegisteredUsers();
                this.updateCurrentPresence();
                this.updateTodayActivity();
            }

            updateRegisteredUsers() {
                const container = document.getElementById('registeredUsers');
                
                if (this.users.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8">No users registered yet</p>';
                    return;
                }

                container.innerHTML = this.users.map(user => `
                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-blue-600"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-900">${user.fullName}</div>
                            <div class="text-xs text-gray-500">${user.macAddress}</div>
                        </div>
                        <div class="text-xs text-green-600">
                            <i class="fas fa-check-circle mr-1"></i>Active
                        </div>
                    </div>
                `).join('');
            }

            updateCurrentPresence() {
                document.getElementById('currentPresence').textContent = this.currentPresence.size;
            }

            updateTodayActivity() {
                const today = new Date().toDateString();
                const todayLogs = this.logs.filter(log => new Date(log.timestamp).toDateString() === today);
                document.getElementById('todayActivity').textContent = todayLogs.length;
            }

            updateLogsTable() {
                const tbody = document.getElementById('logsTableBody');
                
                if (this.logs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">No presence logs available</td></tr>';
                    return;
                }

                tbody.innerHTML = this.logs.map(log => {
                    const statusClass = log.status === 'entered' ? 'text-green-600' : 
                                      log.status === 'exited' ? 'text-red-600' : 'text-blue-600';
                    const statusIcon = log.status === 'entered' ? 'fa-sign-in-alt' : 
                                     log.status === 'exited' ? 'fa-sign-out-alt' : 'fa-user-check';

                    return `
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 text-sm text-gray-900">${log.userName}</td>
                            <td class="px-4 py-3 text-sm">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 ${statusClass}">
                                    <i class="fas ${statusIcon} mr-1"></i>
                                    ${log.status}
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-500">${new Date(log.timestamp).toLocaleString()}</td>
                            <td class="px-4 py-3 text-sm text-gray-500">${log.duration || '-'}</td>
                            <td class="px-4 py-3 text-sm text-gray-500">${log.motionState || '-'}</td>
                            <td class="px-4 py-3 text-sm text-gray-500">${log.simulatedHeartRate ? log.simulatedHeartRate + ' bpm' : '-'}</td>
                        </tr>
                    `;
                }).join('');
            }

            exportLogs() {
                const csvContent = "data:text/csv;charset=utf-8," + 
                    "Name,Status,Timestamp,Duration,Motion State,Heart Rate\n" +
                    this.logs.map(log => 
                        `"${log.userName}","${log.status}","${log.timestamp}","${log.duration || ''}","${log.motionState || ''}","${log.simulatedHeartRate || ''}"`
                    ).join('\n');

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement('a');
                link.setAttribute('href', encodedUri);
                link.setAttribute('download', `pxp_logs_${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            clearLogs() {
                if (confirm('Are you sure you want to clear all presence logs? This action cannot be undone.')) {
                    this.logs = [];
                    localStorage.setItem('pxp_logs', JSON.stringify(this.logs));
                    this.updateLogsTable();
                    document.getElementById('detectionFeed').innerHTML = '<p class="text-gray-500 text-center py-8">Waiting for presence detection...</p>';
                }
            }
        }

        // Initialize PxP Application
        document.addEventListener('DOMContentLoaded', () => {
            window.pxpApp = new PxPApp();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (window.pxpApp) {
                window.pxpApp.stopDetection();
            }
        });
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"96b0e4b10fd0d6c7","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.7.0","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDhY96%2FPLy5H72Q2x73ZIMgJbvIVm%2FP0iPsuRTWipz1dkf54u2j07kC0Ux4OcAeI4q1H5NexYZCfd7kArOMZr5vu%2FlqvIHXwM9Z146s1LlluBIJEAPYrhPwmYfNVxbIjrn%2FG4Q17SO7ptKzZtmIaCnjIjbkv7UWPD1Ftt7hFnkbw73Xq7O92KcvDBlITlvVC%2FjqIIgg0DRc451DJxizCZ2H5NUsyvxp73srZHXgEE5hstoFffEaJyD0Yoc%2F%2FiEXopathPWMofez6PBXL7z0hQllj75RSSEcCfVJBWcJdpRU63%2B3WZKUkvrFBDV7hqEoTABaV8zvg8lpmYNRZlFgelY09vTSB74PnQDYsHzASHTUJNW%2FIVjAf1wLWefVRofKzXNfZEWpabI%2Bbv%2FHoGXFsrmUNBEqGW94ib6LOjb1QgjUzo4Xo%2F9sCnxAM2JrvOsT0mAVN8CZ3wBvkJjoG8hzMYQUxAEODghaaBY%2FUWrZP6empmTxM556TdOemywmsAjYIaYA%3D%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDhY96/PLy5H72Q2x73ZIMgJbvIVm/P0iPsuRTWipz1dkf54u2j07kC0Ux4OcAeI4q1H5NexYZCfd7kArOMZr5vu/lqvIHXwM9Z146s1LlluBIJEAPYrhPwmYfNVxbIjrn/G4Q17SO7ptKzZtmIaCnjIjbkv7UWPD1Ftt7hFnkbw73Xq7O92KcvDBlITlvVC/jqIIgg0DRc451DJxizCZ2H5NUsyvxp73srZHXgEE5hstoFffEaJyD0Yoc//iEXopathPWMofez6PBXL7z0hQllj75RSSEcCfVJBWcJdpRU63+3WZKUkvrFBDV7hqEoTABaV8zvg8lpmYNRZlFgelY09vTSB74PnQDYsHzASHTUJNW/IVjAf1wLWefVRofKzXNfZEWpabI+bv/HoGXFsrmUNBEqGW94ib6LOjb1QgjUzo4Xo/9sCnxAM2JrvOsT0mAVN8CZ3wBvkJjoG8hzMYQUxAEODghaaBY/UWrZP6empmTxM556TdOemywmsAjYIaYA==";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    